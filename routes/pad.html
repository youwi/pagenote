

<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<link   type="text/css"    href="/css/bootstrap.min.css" rel="stylesheet">
<link   type="text/css"    href="/css/font-awesome.min.css"  rel="stylesheet" >

<nav id="pad-header" class="col-xs-12" role="navigation">
	<!--<div class="navbar-header navbar-brand" >-->
			<!--<h2  class='myh2'>wiki</h2>-->
	<!--</div>-->

    <a class="navbar-brand" href="#">文档</a>

	<div class='col-md-6   '  >
		<ol class="breadcrumb breadcrumbfix">
		  <li><a href="/"  id="gotoMain"  class='icon-home'>主页</a></li>
		  <li><a href="/test.html"  id="gotoDeploy"  class="1active" >wiki</a></li>
		</ol>
	</div>
	<!--<div class=' navbar-right'><small>@isyou</small></div>-->
    <div class='btn-group btn-groupfix'  id='tagedit'>
        <span href="#" id='ckeditor' 	class="btn btn-primary  btn-xs">CKeditor</span>
        <a href="#" id='save' 	class="btn btn-primary  btn-xs">保存</a>
        <a href="#" id='upload' class="btn btn-primary  btn-xs">上传文件</a>
        <a href="#" id='edit'   class="btn btn-primary  btn-xs">编辑</a>
        <a href="#" class="btn btn-primary  btn-xs" data-toggle="modal" data-target="#myModal">新建</a>
        <a href="#" id='exit' 	class="btn btn-primary  btn-xs">退出</a>
        <!--<a href="#" id='tog'    class="btn btn-primary  btn-xs ">-->
            <!--&lt;!&ndash;<i class="fa-li fa fa-check-square"></i>a&ndash;&gt;-->
        <!--</a>-->
    </div>


    <!--<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">-->
        <!--Launch demo modal-->
    <!--</button>-->

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body">
                    <div class=" ">
                        <div class="input-group">
                            <span class="input-group-addon" id="basic-addon1">文件名</span>
                            <input id="thfilename" type="text" class="form-control" placeholder="qwer/abc.html" aria-describedby="basic-addon1">
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="newfile">立即新建文件</button>
                </div>
            </div>
        </div>
    </div>

        </div>

</nav>
<div id="WikiContent" data-file="${filename}">${page}</div>
<!--<div id="pad-float">-->
    <!--<div class="container-fluid">-->
        <!--<div class="row-fluid">-->
            <!--<div class="span2">-->
                <!--<div class='btn-group-vertical col-xs-2'>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs" id="tagtask">任务:</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">用$.post("json")来做测试</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">Poster</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">Risk</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">生成目录</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">CKtester</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">添加</a>-->
                    <!--<a href="#" class="btn btn-primary  btn-xs">删除</a>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->

<style>

    .navbar-brand {
        float: left;
        height: 24px;
        padding: 2px 2px;
        font-size: 18px;
        line-height: 20px;
    }
    #pad-header {
        background-color: #333;
        color: #fff;
       /*#height: 48px;*/
        line-height: 16px;
        /*position: fixed;*/
        top: 0;
        left: 0;
        width: 100%;
        min-width: 320px;
        z-index: 10;
        -moz-box-shadow:0px 2px 5px #333333; -webkit-box-shadow:0px 2px 5px #333333; box-shadow:0px 2px 5px #333333;
    }
    .breadcrumbfix{
         padding: 1px 5px;
         margin-bottom: 5px;
        list-style: none;
         background-color: rgba(0, 0, 0, 0);
        border-radius: 4px;
        margin-bottom: 0px;
        margin-top: 5px;
    }
    .btn-groupfix{
        float:right;
        position: absolute;
        right:0px;
        z-index:9999;
    }
</style>
<script >


    var xio;

    $("#newfile").click(function(){
        $.post('/wikiAdd', {
            filename:thfilename.value,
           // wikiContent:$("#WikiContent")[0].innerHTML
        },function(data){
//            if (data.redirect) {
//                // data.redirect contains the string URL to redirect to
                window.location.href = "/"+thfilename.value
//            }else
            //alert(data);

        });
    });
    $("#tagop").click(function(){
        $("#tagedit").slideToggle("slow");
    });
    $("#tagtask").click(function(){

    });
    $("#edit").click(function(){
        window.frames.if.document.designMode='on';
    });
    $("#save").click(function(){
        var filename=$('#WikiContent').data("file");
        //var path=$("#if")[0].dataset.path;
        //window.frames.if.document.designMode='off';
        $.post('/wikiSave', {
           // wikipath:path,
            filename:filename,
            wikiContent:$("#WikiContent")[0].innerHTML
        },function(data){ alert(data);});
    });
    $("#upload").click(function(){
        //alert("#upload");
        $("#uppc")[0].click();
        upac();
    });

    var CK;
    $("#ckeditor").click(function(){
        if(CK==null)
        {
            CK=CKEDITOR.replace('WikiContent');
            //CK.setData(window.frames.if.document.body.innerHTML) //设置内容

            CKEDITOR.on('instanceReady', function (e) {
                //  var td = document.getElementById('cke_contents_' + e.editor.name), tbody = td.parentNode.parentNode;
                // td.style.height = h - tbody.rows[0].offsetHeight - tbody.rows[2].offsetHeight + 'px';
                //$('.cke_contents').css('height', "calc(100% - 210px)");
                $('.cke_contents').css('height', "calc(100% - 170px)");
                frames[0].addEventListener('paste',doparst);//设置可粘贴
                //setTimeout("$('.cke_contents').css('height', $('body').height()-200);",100) ;//设置一个超时对象:自动变高
            });
        }else{
            $("#WikiContent")[0].innerHTML=CK.getData();
            CK.destroy();
            CK=null;
        }
    });
    function  upac(){
        $.ajaxFileUpload(
                {
                    url:'upload.php', //你处理上传文件的服务端
                    secureuri:false,
                    fileElementId:'uppc',
                    dataType: 'json',
                    success: function (data){ alert(data.file_infor);}
                })
        return false;
    };

    function doparst(e){

        var reader = new FileReader();
        var tout;

        if(e.clipboardData.types.indexOf('Files') > -1)
        {
            console.log("data:" + e.clipboardData);
            console.log("types:"+ e.clipboardData.types);
            console.log("getData:"+ e.clipboardData.getData("img/*"));
            //console.log("files[0]:"+ e.clipboardData.files[0]);
            console.log("items[0]:"+ e.clipboardData.items[0]);

            var it=e.clipboardData.items[0];
            //	console.log("items[0].getData():"+ it.getData());
            reader.readAsDataURL( it.getAsFile());
            console.log("tout:",tout);
            console.log("reader",reader);
            console.log("text:"+reader.result.toString());//为结果文件
            xio=reader; //注意读取有时间限制!! 要使用onload来读取结果
            e.clipboardData.setData("text/plain", '<img src="' + reader.result +'" >');
            console.log(e.srcElement);
            reader.onload=function(ev){
                console.log("<img src=\"" + reader.result+"\" >");
                $(e.srcElement).append(  "<img src=\"" + reader.result+"\" >" )  ;
            };
            e.preventDefault();
            console.log(e);
            //  	'<img src="' + reader.result +'" >';//生成图片,然后把图片加入就好了.
        }

    };

    document.onkeydown=function(event){
        var e=event||window.event;
        var keyCode=e.keyCode||e.which;
        if(e.ctrlKey && (keyCode == 83 ))
        {
            $("#f").submit();
            e.returnValue=false;
        }
    }

    document.ready= function () {
        frames[0].addEventListener('paste',doparst);
    }

</script>
